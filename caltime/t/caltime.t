##
# @file caltime.t
#
# テスト
#
# @author Tetsuya Higashi
# @version $Id$
#

use strict;
use warnings;
use Test::More;

use File::Basename qw/dirname/;

my $progpath;
BEGIN { $progpath = dirname($0); }
use lib "$progpath/../lib";
use caltime;

my @test_calc_sum = (
    [ 8.00, 18.00, "8,0,0,,,1,9\n",        ",,,8,0,1,9\n" ],
    [ 9.00, 11.00, "2,0,0,,,0,2\n",        ",,,2,0,0,2\n" ],
    [ 9.00, 12.00, "3,0,0,,,0,3\n",        ",,,3,0,0,3\n" ],
    [ 9.00, 13.00, "3,0,0,,,1,3\n",        ",,,3,0,1,3\n" ],
    [ 9.00, 14.00, "4,0,0,,,1,4\n",        ",,,4,0,1,4\n" ],
    [ 9.00, 15.00, "5,0,0,,,1,5\n",        ",,,5,0,1,5\n" ],
    [ 9.00, 16.00, "6,0,0,,,1,6\n",        ",,,6,0,1,6\n" ],
    [ 9.00, 17.00, "7,0,0,,,1,7\n",        ",,,7,0,1,7\n" ],
    [ 9.00, 18.00, "8,0,0,,,1,8\n",        ",,,8,0,1,8\n" ],
    [ 9.00, 19.00, "8,0.5,0,,,1.5,8.5\n",  ",,,8.5,0,1.5,8.5\n" ],
    [ 9.00, 20.00, "8,1.5,0,,,1.5,9.5\n",  ",,,9.5,0,1.5,9.5\n" ],
    [ 9.00, 21.00, "8,2.5,0,,,1.5,10.5\n", ",,,10.5,0,1.5,10.5\n" ],
    [ 9.00, 22.00, "8,3,0,,,2,11\n",       ",,,11,0,2,11\n" ],
    [ 9.00, 23.00, "8,3,1,,,2,12\n",       ",,,11,1,2,12\n" ],
    [ 9.00, 24.00, "8,3,2,,,2,13\n",       ",,,11,2,2,13\n" ],          # 00:00
    [ 9.00, 25.00, "8,3,2,,,3,13\n",       ",,,11,2,3,13\n" ],          # 01:00
    [ 9.00, 26.00, "8,3,3,,,3,14\n",       ",,,11,3,3,14\n" ],          # 02:00
    [ 9.00, 27.00, "8,3,4,,,3,15\n",       ",,,11,4,3,15\n" ],          # 03:00
    [ 9.00, 28.00, "8,3,4.5,,,3.5,15.5\n", ",,,11,4.5,3.5,15.5\n" ],    # 04:00
    [ 9.00, 29.00, "8,3,5.5,,,3.5,16.5\n", ",,,11,5.5,3.5,16.5\n" ],    # 05:00
    [ 9.00, 30.00, "8,4,5.5,,,3.5,17.5\n", ",,,12,5.5,3.5,17.5\n" ],    # 06:00
    [ 9.00, 31.00, "8,5,5.5,,,3.5,18.5\n", ",,,13,5.5,3.5,18.5\n" ],    # 07:00
    [ 9.00, 32.00, "8,6,5.5,,,3.5,19.5\n", ",,,14,5.5,3.5,19.5\n" ],    # 08:00
    [ 9.00, 33.00, "8,6.5,5.5,,,4,20\n",   ",,,14.5,5.5,4,20\n" ],      # 09:00
);

my @test_conv_hour = (
    [ "23:00", 0,  "23:00" ],
    [ "00:00", 0,  "24:00" ],
    [ "01:00", 0,  "25:00" ],
    [ "02:00", 0,  "26:00" ],
    [ "03:00", 0,  "27:00" ],
    [ "04:00", 0,  "28:00" ],
    [ "05:00", 0,  "29:00" ],
    [ "06:00", 0,  "30:00" ],
    [ "07:00", 0,  "31:00" ],
    [ "08:00", 0,  "32:00" ],
    [ "09:00", 0,  "33:00" ],
    [ "10:00", 0,  "10:00" ],
    [ "23:00", 1,  "23:00" ],
    [ "00:00", 1,  "24:00" ],
    [ "09:00", 1,  "33:00" ],
    [ "10:00", 1,  "34:00" ],
    [ "00:00", 15, "24:00" ],
    [ "22:00", 15, "46:00" ],
    [ "23:00", 15, "47:00" ],
    [ "24:00", 15, "48:00" ],
    [ "07:00", -1, "31:00" ],
    [ "08:00", -1, "32:00" ],
    [ "09:00", -1, "09:00" ],
    [ "23:00", -9, "23:00" ],
    [ "00:00", -9, "24:00" ],
    [ "01:00", -9, "01:00" ],
);

plan tests => scalar @test_calc_sum * 2 + scalar @test_conv_hour;

foreach my $t (@test_calc_sum) {
    my $output = calc_sum( $t->[0], $t->[1], 0, '' );
    printf "%02.2f-%02.2f\n", $t->[0], $t->[1];
    is( $output, $t->[2] );
}

foreach my $t (@test_calc_sum) {
    my $output = calc_sum( $t->[0], $t->[1], 0, 1 );
    printf "%02.2f-%02.2f\n", $t->[0], $t->[1];
    is( $output, $t->[3] );
}

foreach my $t (@test_conv_hour) {
    my $hconv = conv_hour( $t->[0], $t->[1] );
    printf "time=%s offset=%d\n", $t->[0], $t->[1];
    is( $hconv, $t->[2] );
}
